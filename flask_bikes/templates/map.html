{% extends 'base.html' %}

{% block title %}Map - DublinBikes{% endblock %}

{% block map %}
<h1>The map</h1>
<div id="map"></div>
<script>
    // Define a JavaScript variable and embed the data
    const stations = {{ stationsData|tojson }};

    async function initMap() {

    const dublin = { lat: 53.3476326, lng: -6.266265 };
  
    const { Map, InfoWindow } = await google.maps.importLibrary("maps");
    const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
  
    const map = new Map(document.getElementById("map"), {
        zoom: 14,
        center: dublin,
        mapId: "DEMO_MAP_ID",
    });

    const infoWindow = new InfoWindow();

    try {
        stations.forEach(station => {
            // Add marker to the map
            var marker = new AdvancedMarkerElement({
                        map,
                        position: {lat: station.lat, lng: station.lng},
                        title: station.title,
                    });

            // Marker click listener (Display title)
            marker.addListener("click", ({ domEvent, latLng }) => {
                const { target } = domEvent;
                infoWindow.close();
                infoWindow.setContent(marker.title);
                infoWindow.open(marker.map, marker);
            });
        });
    } catch (error) {
        console.error('Error fetching data', error);
    }
}

</script>
{% endblock %}
